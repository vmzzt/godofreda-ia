# ================================
# GODOFREDA ALERTMANAGER CONFIGURATION
# ================================
# Configura√ß√£o de alertas e notifica√ß√µes
# ================================

global:
  # ================================
  # CONFIGURA√á√ïES GLOBAIS
  # ================================
  resolve_timeout: 5m
  smtp_smarthost: 'localhost:587'
  smtp_from: 'godofreda@localhost'
  smtp_auth_username: 'godofreda'
  smtp_auth_password: 'godofreda123'
  smtp_require_tls: true
  
  # ================================
  # CONFIGURA√á√ïES DE WEBHOOK
  # ================================
  webhook_url: 'http://godofreda-api:8000/webhook/alerts'
  webhook_timeout: 10s
  
  # ================================
  # CONFIGURA√á√ïES DE SLACK (OPCIONAL)
  # ================================
  slack_api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'

# ================================
# ROTEAMENTO DE ALERTAS
# ================================
route:
  # ================================
  # CONFIGURA√á√ïES DE GRUPO
  # ================================
  group_by: ['alertname', 'service', 'severity']
  group_wait: 10s
  group_interval: 10s
  repeat_interval: 1h
  
  # ================================
  # RECEPTOR PADR√ÉO
  # ================================
  receiver: 'godofreda-webhook'
  
  # ================================
  # ROTAS ESPEC√çFICAS
  # ================================
  routes:
    # ================================
    # ALERTAS CR√çTICOS - EMAIL + WEBHOOK
    # ================================
    - match:
        severity: critical
      receiver: 'godofreda-critical'
      group_wait: 0s
      group_interval: 5s
      repeat_interval: 30m
    
    # ================================
    # ALERTAS DE SISTEMA - EMAIL
    # ================================
    - match:
        service: system
      receiver: 'godofreda-system'
      group_wait: 30s
      group_interval: 5m
      repeat_interval: 4h
    
    # ================================
    # ALERTAS DE PERFORMANCE - WEBHOOK
    # ================================
    - match:
        severity: warning
      receiver: 'godofreda-performance'
      group_wait: 1m
      group_interval: 5m
      repeat_interval: 2h

# ================================
# RECEPTORES
# ================================
receivers:
  # ================================
  # WEBHOOK PADR√ÉO
  # ================================
  - name: 'godofreda-webhook'
    webhook_configs:
      - url: 'http://godofreda-api:8000/webhook/alerts'
        send_resolved: true
        http_config:
          timeout: 10s
          tls_config:
            insecure_skip_verify: false
        max_alerts: 0

  # ================================
  # ALERTAS CR√çTICOS
  # ================================
  - name: 'godofreda-critical'
    webhook_configs:
      - url: 'http://godofreda-api:8000/webhook/alerts'
        send_resolved: true
        http_config:
          timeout: 5s
    email_configs:
      - to: 'admin@godofreda.ai'
        send_resolved: true
        headers:
          subject: 'üö® ALERTA CR√çTICO - Godofreda'
        html: |
          <h2>üö® Alerta Cr√≠tico Detectado</h2>
          <p><strong>Servi√ßo:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>Alerta:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>Inst√¢ncia:</strong> {{ .GroupLabels.instance }}</p>
          <p><strong>Descri√ß√£o:</strong> {{ .CommonAnnotations.description }}</p>
          <p><strong>In√≠cio:</strong> {{ .StartsAt }}</p>
          <hr>
          <p><em>Godofreda Monitoring System</em></p>

  # ================================
  # ALERTAS DE SISTEMA
  # ================================
  - name: 'godofreda-system'
    email_configs:
      - to: 'admin@godofreda.ai'
        send_resolved: true
        headers:
          subject: '‚ö†Ô∏è Alerta de Sistema - Godofreda'
        html: |
          <h2>‚ö†Ô∏è Alerta de Sistema</h2>
          <p><strong>Servi√ßo:</strong> {{ .GroupLabels.service }}</p>
          <p><strong>Alerta:</strong> {{ .GroupLabels.alertname }}</p>
          <p><strong>Descri√ß√£o:</strong> {{ .CommonAnnotations.description }}</p>
          <hr>
          <p><em>Godofreda Monitoring System</em></p>

  # ================================
  # ALERTAS DE PERFORMANCE
  # ================================
  - name: 'godofreda-performance'
    webhook_configs:
      - url: 'http://godofreda-api:8000/webhook/alerts'
        send_resolved: true
        http_config:
          timeout: 10s

  # ================================
  # SLACK (OPCIONAL)
  # ================================
  - name: 'godofreda-slack'
    slack_configs:
      - api_url: 'https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK'
        channel: '#godofreda-alerts'
        send_resolved: true
        title: 'üö® Alerta Godofreda'
        text: |
          *Alerta:* {{ .GroupLabels.alertname }}
          *Servi√ßo:* {{ .GroupLabels.service }}
          *Severidade:* {{ .GroupLabels.severity }}
          *Descri√ß√£o:* {{ .CommonAnnotations.description }}
          *In√≠cio:* {{ .StartsAt }}

# ================================
# REGRAS DE INIBI√á√ÉO
# ================================
inhibit_rules:
  # ================================
  # INIBIR ALERTAS DE WARNING QUANDO CR√çTICO
  # ================================
  - source_match:
      severity: 'critical'
    target_match:
      severity: 'warning'
    equal: ['alertname', 'service', 'instance']
  
  # ================================
  # INIBIR ALERTAS DE SISTEMA QUANDO CONTAINER DOWN
  # ================================
  - source_match:
      alertname: 'ContainerDown'
    target_match:
      service: 'system'
    equal: ['instance']

# ================================
# TEMPLATES
# ================================
templates:
  - '/etc/alertmanager/template/*.tmpl'

# ================================
# CONFIGURA√á√ïES DE TIME
# ================================
time_intervals:
  # ================================
  # HOR√ÅRIO DE TRABALHO (9h-18h)
  # ================================
  - name: workdays
    time_intervals:
      - weekdays: ['monday:friday']
        times:
          - start_time: 09:00
            end_time: 18:00
  
  # ================================
  # FINS DE SEMANA
  # ================================
  - name: weekends
    time_intervals:
      - weekdays: ['saturday', 'sunday']
  
  # ================================
  # HOR√ÅRIO NOTURNO (22h-6h)
  # ================================
  - name: night
    time_intervals:
      - times:
          - start_time: 22:00
            end_time: 06:00 